[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset Maintenance Request",
  "enabled": 1,
  "modified": "2025-10-17 10:02:21.994098",
  "module": "asset_management",
  "name": "Asset in use",
  "script": "frappe.ui.form.on(\"Asset Maintenance Request\", {\n    setup: function(frm) {\n        frm.set_query(\"custom_status\", function() {\n            return {\n                filters: {\n                    custom_status: \"In use\"\n                }\n            };\n        });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Task",
  "enabled": 0,
  "modified": "2025-10-17 07:00:06.647347",
  "module": "asset_management",
  "name": "Automatically Fill Subject",
  "script": "frappe.ui.form.on('Task', {\n    before_save: function(frm) {\n        // Auto-fill subject if it's empty\n        if (!frm.doc.subject) {\n            let subject_text = \"Asset Task\";\n\n            if (frm.doc.asset) {\n                subject_text = `Maintenance for ${frm.doc.asset}`;\n            } else if (frm.doc.asset_maintenance_request) {\n                subject_text = `Maintenance Request ${frm.doc.asset_maintenance_request}`;\n            }\n\n            frm.set_value('subject', subject_text);\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset Maintenance Request",
  "enabled": 1,
  "modified": "2025-10-17 09:37:58.033993",
  "module": "asset_management",
  "name": "Add the “Create Maintenance Task” Button",
  "script": "frappe.ui.form.on(\"Asset Maintenance Request\", {\n    refresh: function(frm) {\n        if (!frm.is_new() && frappe.user.has_role(\"Maintenance Team Supervisor\")) {\n            frm.add_custom_button(__('Create Maintenance Task'), function() {\n                frappe.call({\n                    method: \"frappe.client.insert\",\n                    args: {\n                        doc: {\n                            doctype: \"Task\",\n                            subject: `${frm.doc.asset_name || ''} - ${frm.doc.maintenance_type || ''} - ${frm.doc.name}`,\n                            asset_maintenance_request: frm.doc.name,\n                            asset: frm.doc.asset,\n                            maintenance_type: frm.doc.maintenance_type,\n                            expected_completion_date: frm.doc.expected_completion_date,\n                            priority: frm.doc.priority,\n                            status: \"Open\"\n                        }\n                    },\n                    callback: function(r) {\n                        if (!r.exc) {\n                            frappe.msgprint(`✅ Task <b>${r.message.name}</b> created successfully.`);\n                            frm.set_value(\"status\", \"In Progress\");\n                            frm.save();\n                        }\n                    }\n                });\n            }).addClass('btn-primary');\n        }\n    }\n});\n",
  "view": "Form"
 }
]